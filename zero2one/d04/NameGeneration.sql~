-- Random name generator from https://thecodecave.com/generating-random-names-in-mysql/

DROP function if exists generate_fname;
DELIMITER $$
CREATE FUNCTION generate_fname () RETURNS varchar(255)
BEGIN
	RETURN ELT(FLOOR(1 + (RAND() * (100-1))), "James","Mary","John","Patricia","Robert","Linda","Michael","Barbara","William","Elizabeth","David","Jennifer","Richard","Maria","Charles","Susan","Joseph","Margaret","Thomas","Dorothy","Christopher","Lisa","Daniel","Nancy","Paul","Karen","Mark","Betty","Donald","Helen","George","Sandra","Kenneth","Donna","Steven","Carol","Edward","Ruth","Brian","Sharon","Ronald","Michelle","Anthony","Laura","Kevin","Sarah","Jason","Kimberly","Matthew","Deborah","Gary","Jessica","Timothy","Shirley","Jose","Cynthia","Larry","Angela","Jeffrey","Melissa","Frank","Brenda","Scott","Amy","Eric","Anna","Stephen","Rebecca","Andrew","Virginia","Raymond","Kathleen","Gregory","Pamela","Joshua","Martha","Jerry","Debra","Dennis","Amanda","Walter","Stephanie","Patrick","Carolyn","Peter","Christine","Harold","Marie","Douglas","Janet","Henry","Catherine","Carl","Frances","Arthur","Ann","Ryan","Joyce","Roger","Diane");
END$$

DELIMITER ;

DROP function if exists generate_lname;
DELIMITER $$
CREATE FUNCTION generate_lname () RETURNS varchar(255)
BEGIN
	RETURN ELT(FLOOR(1 + (RAND() * (100-1))), "Smith","Johnson","Williams","Jones","Brown","Davis","Miller","Wilson","Moore","Taylor","Anderson","Thomas","Jackson","White","Harris","Martin","Thompson","Garcia","Martinez","Robinson","Clark","Rodriguez","Lewis","Lee","Walker","Hall","Allen","Young","Hernandez","King","Wright","Lopez","Hill","Scott","Green","Adams","Baker","Gonzalez","Nelson","Carter","Mitchell","Perez","Roberts","Turner","Phillips","Campbell","Parker","Evans","Edwards","Collins","Stewart","Sanchez","Morris","Rogers","Reed","Cook","Morgan","Bell","Murphy","Bailey","Rivera","Cooper","Richardson","Cox","Howard","Ward","Torres","Peterson","Gray","Ramirez","James","Watson","Brooks","Kelly","Sanders","Price","Bennett","Wood","Barnes","Ross","Henderson","Coleman","Jenkins","Perry","Powell","Long","Patterson","Hughes","Flores","Washington","Butler","Simmons","Foster","Gonzales","Bryant","Alexander","Russell","Griffin","Diaz","Hayes");
END$$
DELIMITER ;

DROP function if exists generate_places;
DELIMITER $$
CREATE FUNCTION generate_places () RETURNS varchar(255)
BEGIN
	RETURN ELT(FLOOR(1 + (RAND() * (26))), "Mordor", "The Shire", "Winterfell", "The Wall", "Caprica", "Atlantis", "Bikini Bottom", "Naboo", "Netherworld", "Tatooine", "Jupiter", "Netuno", "Valfenda", "Softville", "Crematoria", "Texas", "Vegas", "Pluto", "Kabuto", "Thra", "Kings Landing", "Hogwarts", "Haven", "Vault 81", "Earth", "21 Jump Street");
END$$

DELIMITER ;

DROP function if exists valor;

DELIMITER $$
CREATE FUNCTION valor () RETURNS INT
BEGIN
	RETURN FLOOR(1 + (RAND() * (10000)));
END$$

-- Random dates From https://stackoverflow.com/questions/11906572/mysql-insert-random-datetime-in-a-given-datetime-range/28944156#28944156
DELIMITER ;

DROP function if exists randomDate;
DELIMITER $$
CREATE FUNCTION randomDate () RETURNS datetime
BEGIN
	RETURN from_unixtime(unix_timestamp('2013-1-1') + floor(rand() * (unix_timestamp('2018-2-16') - unix_timestamp('2013-1-1') + 1)));
END$$

DELIMITER ;


-- Procedure to generate a clients table
DROP PROCEDURE if exists clientsGenerator;

DELIMITER $$
CREATE PROCEDURE clientsGenerator()
BEGIN
	CREATE TABLE Clientes(
	       	ID BIGINT NOT NULL AUTO_INCREMENT,
       		NOME VARCHAR(128) NOT NULL,
		EMAIL VARCHAR(128) NULL,
       		PRIMARY KEY (ID)
		);
	SET @x:=1;
	WHILE @x <= 10 DO
	      set @Pnome = generate_fname();
	      set @Lnome = generate_lname();
	      INSERT INTO Clientes (NOME, EMAIL) VALUES (CONCAT(@Pnome, ' ', @LNome), CONCAT(@Pnome,'_', @LNome, '@gmail.com'));
	      SET @x = @x + 1;
	END WHILE;
END$$

-- Procedure to generate request table
DELIMITER ;

DROP PROCEDURE if exists requestGenerator;

DELIMITER $$
CREATE PROCEDURE requestGenerator()
BEGIN
	CREATE TABLE Pedidos(
	       	ID BIGINT NOT NULL PRIMARY KEY AUTO_INCREMENT,
		ID_Cliente BIGINT NOT NULL,
		data_pedido DATETIME NOT NULL,
       		endereco VARCHAR(128) NULL,
       		CONSTRAINT pedidosUnicos UNIQUE(ID_Cliente, data_pedido, endereco),
		FOREIGN KEY (ID_Cliente) REFERENCES Clientes(ID) ON DELETE CASCADE
		);
	SET @x:=1;
	WHILE @x <= 100 DO
	      SET @idCliente = FLOOR(1 + (RAND() * (10)));
	      SET @diaPedido = randomDate();
	      SET @endereco = generate_places();
	      INSERT INTO Pedidos (ID_Cliente, data_pedido, endereco) VALUES (@idCliente, @diaPedido, @endereco);
	      SET @x = @x + 1;
	END WHILE;
END$$

DROP TABLE if exists Parcelas;
DROP TABLE if exists Pedidos;
DROP TABLE if exists Clientes;

CALL clientsGenerator();
CALL requestGenerator();
